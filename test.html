<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment System Test - SaaS Pricing Calculator</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0a;
      color: #fff;
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    h1 {
      color: #10b981;
      margin-bottom: 30px;
    }
    h2 {
      color: #fff;
      margin-top: 0;
      border-bottom: 2px solid #333;
      padding-bottom: 10px;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      margin-left: 10px;
    }
    .status.pass {
      background: #10b981;
      color: #000;
    }
    .status.fail {
      background: #ef4444;
      color: #fff;
    }
    .status.loading {
      background: #f59e0b;
      color: #000;
    }
    .test-item {
      margin: 15px 0;
      padding-left: 20px;
    }
    .test-item::before {
      content: "‚Üí ";
      color: #666;
      margin-left: -20px;
    }
    .btn {
      background: #10b981;
      color: #000;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 0;
      display: inline-block;
      text-decoration: none;
    }
    .btn:hover {
      background: #059669;
    }
    .code {
      background: #262626;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 14px;
    }
    .alert {
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 6px;
      padding: 15px;
      margin: 20px 0;
    }
    .alert.info {
      border-color: #3b82f6;
      background: #1e3a8a20;
    }
    .alert.success {
      border-color: #10b981;
      background: #06402620;
    }
    .alert.warning {
      border-color: #f59e0b;
      background: #78350f20;
    }
    stripe-buy-button {
      width: 100%;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Payment System Test</h1>
    
    <div class="test-section">
      <h2>1. Page Load Status <span id="page-status" class="status loading">Testing...</span></h2>
      <div class="test-item">Page loaded: <span id="page-loaded" class="code">checking...</span></div>
      <div class="test-item">Buy button script: <span id="script-loaded" class="code">checking...</span></div>
      <div class="test-item">Current URL: <span id="current-url" class="code"></span></div>
    </div>

    <div class="test-section">
      <h2>2. Stripe Configuration <span id="stripe-status" class="status loading">Testing...</span></h2>
      <div class="test-item">Buy Button ID: <span class="code">buy_btn_1RqOC7I6kujeAM5FZbqTtxFL</span></div>
      <div class="test-item">Mode: <span class="code">Live (production)</span></div>
      <div class="test-item">Success URL: <span class="code">https://saas-pricing-calculator-2025.vercel.app/success</span></div>
      <div class="test-item">Button loaded: <span id="button-loaded" class="code">checking...</span></div>
    </div>

    <div class="test-section">
      <h2>3. Test Buy Button</h2>
      <p>Click the button below to test the payment flow:</p>
      <stripe-buy-button
        buy-button-id="buy_btn_1RqOC7I6kujeAM5FZbqTtxFL"
        publishable-key="pk_live_51RqLWCI6kujeAM5FQSJbNLxHrxgCmrLqTe9187pxEGVbxxRXIeTuDMd7mv6cwAV68ufyvcBgHHRFC8dx0XT6Mxxn003tmk9NAN"
        success-url="https://saas-pricing-calculator-2025.vercel.app/success"
      >
      </stripe-buy-button>
      
      <div class="alert info" style="margin-top: 20px;">
        <strong>Test Instructions:</strong><br>
        1. Click the buy button above<br>
        2. Use test card: <span class="code">4242 4242 4242 4242</span><br>
        3. Expiry: <span class="code">12/34</span>, CVC: <span class="code">123</span>, ZIP: <span class="code">12345</span><br>
        4. Complete purchase and check if you're redirected to success page
      </div>
    </div>

    <div class="test-section">
      <h2>4. Navigation Test</h2>
      <p>Test all pages:</p>
      <a href="/" class="btn">Landing Page</a>
      <a href="/success" class="btn">Success Page</a>
      <a href="/calculator" class="btn">Calculator</a>
      <a href="/privacy" class="btn">Privacy</a>
      <a href="/terms" class="btn">Terms</a>
    </div>

    <div class="test-section">
      <h2>5. Redirect Configuration Status</h2>
      <div class="alert warning">
        <strong>‚ö†Ô∏è Manual Configuration Required:</strong><br>
        If the automatic redirect doesn't work after payment, you need to configure it in Stripe Dashboard:
        <ol>
          <li>Log into <a href="https://dashboard.stripe.com" target="_blank" style="color: #3b82f6;">Stripe Dashboard</a></li>
          <li>Go to Buy Buttons section</li>
          <li>Find button ID: <span class="code">buy_btn_1RqOC7I6kujeAM5FZbqTtxFL</span></li>
          <li>Edit the button</li>
          <li>In "After payment" section, enable redirect</li>
          <li>Enter: <span class="code">https://saas-pricing-calculator-2025.vercel.app/success</span></li>
          <li>Save changes</li>
        </ol>
      </div>
    </div>

    <div class="test-section">
      <h2>6. Console Log</h2>
      <div id="console-output" style="background: #000; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 14px; max-height: 300px; overflow-y: auto;">
        <div style="color: #666;">Console output will appear here...</div>
      </div>
    </div>
  </div>

  <!-- Load Stripe Buy Button script -->
  <script async src="https://js.stripe.com/v3/buy-button.js"></script>

  <script>
    // Test script
    const log = (message, type = 'info') => {
      const output = document.getElementById('console-output');
      const time = new Date().toLocaleTimeString();
      const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6';
      output.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
      output.scrollTop = output.scrollHeight;
    };

    // Check page load
    window.addEventListener('load', () => {
      document.getElementById('page-loaded').textContent = 'Yes ‚úì';
      document.getElementById('current-url').textContent = window.location.href;
      log('Page loaded successfully', 'success');
      
      // Check if Stripe script loaded
      if (window.StripeCheckout || document.querySelector('script[src*="stripe.com"]')) {
        document.getElementById('script-loaded').textContent = 'Yes ‚úì';
        document.getElementById('page-status').className = 'status pass';
        document.getElementById('page-status').textContent = 'Passed';
        log('Stripe script loaded', 'success');
      } else {
        document.getElementById('script-loaded').textContent = 'No ‚úó';
        document.getElementById('page-status').className = 'status fail';
        document.getElementById('page-status').textContent = 'Failed';
        log('Stripe script not loaded', 'error');
      }
    });

    // Check button load
    let checkInterval = setInterval(() => {
      const button = document.querySelector('stripe-buy-button');
      if (button && button.shadowRoot) {
        document.getElementById('button-loaded').textContent = 'Yes ‚úì';
        document.getElementById('stripe-status').className = 'status pass';
        document.getElementById('stripe-status').textContent = 'Passed';
        log('Stripe Buy Button initialized', 'success');
        clearInterval(checkInterval);
        
        // Try to detect button attributes
        const successUrl = button.getAttribute('success-url');
        if (successUrl) {
          log(`Success URL configured: ${successUrl}`, 'success');
        } else {
          log('Success URL not detected in button attributes', 'error');
        }
      }
    }, 500);

    // Timeout after 5 seconds
    setTimeout(() => {
      if (document.getElementById('button-loaded').textContent === 'checking...') {
        document.getElementById('button-loaded').textContent = 'No ‚úó';
        document.getElementById('stripe-status').className = 'status fail';
        document.getElementById('stripe-status').textContent = 'Failed';
        log('Stripe Buy Button failed to load', 'error');
        clearInterval(checkInterval);
      }
    }, 5000);

    // Listen for errors
    window.addEventListener('error', (e) => {
      log(`Error: ${e.message}`, 'error');
    });

    // Check for purchase completion
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
      log('Payment completed successfully!', 'success');
      const alert = document.createElement('div');
      alert.className = 'alert success';
      alert.innerHTML = '<strong>‚úÖ Payment Successful!</strong><br>The redirect is working correctly.';
      document.querySelector('.container').insertBefore(alert, document.querySelector('.test-section'));
    }
  </script>
</body>
</html>